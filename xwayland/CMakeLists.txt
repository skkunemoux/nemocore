FIND_PACKAGE(PkgConfig REQUIRED)

PKG_CHECK_MODULES(PIXMAN REQUIRED pixman-1)
INCLUDE_DIRECTORIES(${PIXMAN_INCLUDE_DIRS})
LINK_DIRECTORIES(${PIXMAN_LIBRARY_DIRS})

PKG_CHECK_MODULES(WAYLANDSERVER REQUIRED wayland-server)
INCLUDE_DIRECTORIES(${WAYLANDSERVER_INCLUDE_DIRS})
LINK_DIRECTORIES(${WAYLANDSERVER_LIBRARY_DIRS})

PKG_CHECK_MODULES(XCB REQUIRED xcb)
INCLUDE_DIRECTORIES(${XCB_INCLUDE_DIRS})
LINK_DIRECTORIES(${XCB_LIBRARY_DIRS})

PKG_CHECK_MODULES(XCBRENDER REQUIRED xcb-render)
INCLUDE_DIRECTORIES(${XCBRENDER_INCLUDE_DIRS})
LINK_DIRECTORIES(${XCBRENDER_LIBRARY_DIRS})

PKG_CHECK_MODULES(XCBXFIXES REQUIRED xcb-xfixes)
INCLUDE_DIRECTORIES(${XCBXFIXES_INCLUDE_DIRS})
LINK_DIRECTORIES(${XCBXFIXES_LIBRARY_DIRS})

PKG_CHECK_MODULES(XCBCOMPOSITE REQUIRED xcb-composite)
INCLUDE_DIRECTORIES(${XCBCOMPOSITE_INCLUDE_DIRS})
LINK_DIRECTORIES(${XCBCOMPOSITE_LIBRARY_DIRS})

PKG_CHECK_MODULES(XCURSOR REQUIRED xcursor)
INCLUDE_DIRECTORIES(${XCURSOR_INCLUDE_DIRS})
LINK_DIRECTORIES(${XCURSOR_LIBRARY_DIRS})

option(WITH_XWAYLAND_DEBUG "Build with XWAYLAND DEBUG" OFF)

include_directories(
	${CMAKE_SOURCE_DIR}/asst
	${CMAKE_SOURCE_DIR}/helper
	${CMAKE_SOURCE_DIR}/compz
	${CMAKE_BINARY_DIR}/compz
	${CMAKE_SOURCE_DIR}/shell
	${CMAKE_BINARY_DIR}/shell
	${CMAKE_SOURCE_DIR}/xwayland
	)

set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS}")
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${CMAKE_C_FLAGS}")
set(CMAKE_LINK_FLAGS "${CMAKE_LINK_FLAGS}")

if(WITH_XWAYLAND_DEBUG)
	set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -DXWAYLAND_DEBUG_ON")
endif(WITH_XWAYLAND_DEBUG)

add_library(nemoxwayland SHARED
	xserver.c
	xmanager.c
	selection.c
	cursor.c
	dnd.c
	hashhelper.c
	)

TARGET_LINK_LIBRARIES(nemoxwayland
	nemoasst
	nemohelper
	nemocompz
	nemoshell
	${XCB_LIBRARIES}
	${XCBRENDER_LIBRARIES}
	${XCBXFIXES_LIBRARIES}
	${XCBCOMPOSITE_LIBRARIES}
	${XCURSOR_LIBRARIES}
	)

set(NEMOXWAYLAND_PKGCONFIG_REQUIRES "nemocompz nemoshell xcb-render xcb-composite xcursor")

INSTALL(TARGETS nemoxwayland DESTINATION lib${CMAKE_LIBRARY_SUFFIX})

set(HEADER_FILES
	${CMAKE_SOURCE_DIR}/xwayland/xserver.h
	)

configure_file(
	nemoxwayland.pc.in
	nemoxwayland.pc
	@ONLY
	)

INSTALL(FILES ${HEADER_FILES} DESTINATION include/nemoxwayland)
INSTALL(FILES ${CMAKE_BINARY_DIR}/xwayland/nemoxwayland.pc DESTINATION lib${CMAKE_LIBRARY_SUFFIX}/pkgconfig)
